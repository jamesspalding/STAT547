---
title: "STAT547 Final Report"
author: "James Spalding"
date: "2024-04-05"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)

source("functions.R")
source("species-joint-data.R")
source(paste0(getwd(),"/files/powerGraphs/Power-graphs-mean.R"))

library(gt)
library(gtExtras)
```

```{r, eval = F}
# Comparisons by joint

#H0: Misorientation angle is the same between joints
#Ha: It isnt

#Bonferroni adjustment: .05/10 = .005

arrayPerm(array.CubCal, array.Mt5CubAP)
arrayPerm(array.CubCal, array.NavCub)
arrayPerm(array.CubCal, array.NavTal)
arrayPerm(array.CubCal, array.TalCal, alt = "greater") #

arrayPerm(array.Mt5CubAP, array.NavCub)
arrayPerm(array.Mt5CubAP, array.NavTal, alt = "greater") #
arrayPerm(array.Mt5CubAP, array.TalCal, alt = "greater") #

arrayPerm(array.NavCub, array.NavTal)
arrayPerm(array.NavCub, array.TalCal, alt = "greater") #

arrayPerm(array.NavTal, array.TalCal, alt = "greater") #
```



```{r, eval = F}
# Comparisons by species

#H0: Misorientation angle is the same between species
#Ha: It isnt

#Bonferroni adjustment: .05/3 = .0167


arrayPerm(humanArray, chimpArray)

arrayPerm(humanArray, baboonArray)

arrayPerm(baboonArray, chimpArray)

#Conclusion: Average misorientation angle is the same for all contrasts between species.
```


```{r, eval = F}
# Comparisons by joint and species

#H0: Misorientation angle of specific joint is the same between species
#Ha: It isnt

#Bonferroni adjustment: .05/3 = .0167

### CubCal ###
arrayPerm(human.CubCal, chimp.CubCal)
arrayPerm(human.CubCal, baboon.CubCal)
arrayPerm(baboon.CubCal, chimp.CubCal)
#No Diff


### Mt5CubAP (N/A for Baboon) ###
#alpha = .05
arrayPerm(human.CubCal, chimp.CubCal, alt = "greater") #
#Humans have greater misorient angle than chimps.


### NavCub ###
arrayPerm(human.NavCub, chimp.NavCub)
arrayPerm(human.NavCub, baboon.NavCub)
arrayPerm(baboon.NavCub, chimp.NavCub)
#None significant


### NavTal ###
arrayPerm(human.NavTal, chimp.NavTal, alt = "greater") #
arrayPerm(human.NavTal, baboon.NavTal, alt = "greater") #
arrayPerm(baboon.NavTal, chimp.NavTal)
#Humans have greater misorient angle than both chimps and baboons.


### TalCal ###
arrayPerm(human.TalCal, chimp.TalCal)
arrayPerm(human.TalCal, baboon.TalCal, alt = "greater") #
arrayPerm(baboon.TalCal, chimp.TalCal)
#Humans have greater misorient angle than both chimps and baboons.
```

# Introduction

**The goal of this paper is to use 3-D rotational data to discover similarities and differences in foot joints between humans and some of our closest relatives: chimpanzees and baboons.**

Our test statistic, Average Misorientation Angle (AMA) is the mean of the misorientation angles at different times, measured in radian. It is the AMA measures the smallest angle in of rotation needed to get from rotation $O_i$ to mean rotation $M$. Each individual angle is calculated with the following formula:

$$\text{mis}(O_i,M) = arccos \frac{trace(O^T_iM)-1}{2}$$

The data provided contains 3D rotation coordinates for 6 humans, 4 chimpanzees, 7 baboons. Each of these subjects had tests performed on CubCal, mt5CubAP, NavCub, NavTal, and TalCal joints. 

# Permutation Tests

A permutation test is a test that involves resampling small samples with different combinations of variables to simulate entire populations. The null hypothesis of a permutation test states that two samples come from the same distribution; the alternative hypothesis states that they come from different distributions.

The p-value is computed by taking the mean misorientation angle from the observed data, shuffling/permuting all the data, taking a random sample of the same size as the observed data (permuted data), taking the mean misorientation angle of the permuted data, and comparing it to the observed value. This process is then repeated a large number of times and counted how many times the observed angle > permuted angle. This number is then divided by the number of permutations to get the p-value.

A variety permutation test will be applied to my data to determine whether or not the AMAs broadly differ between species and joints, as well as specific joints between species. Each test was conducted using 10,000 permutations.

\newpage

First, I looked to see if there were differences in the AMA between the different joints studied; independent of the species. In order to check this, I performed permutation tests to test for differences between joints. Since there were 5 joints in the study, 10 comparisons were computed. A test-wise $\alpha$ level of 0.005 was used, which leads to a family-wide $\alpha$ level of 0.05.

Overall orientation angle by species was also tested using the same procedure. As 3 tests were conducted, a test-wise $\alpha$ of 0.0167 was used. However, none of the species were overall significantly different from each other. The values and results are shown in *table 1* below.

```{r}
##### Joint P = .005 #####
jointComp = c("CubCal - Mt5CubAP",
               "CubCal - NavCub",
               "CubCal - NavTal",
               "CubCal - TalCal", #
               "Mt5CubAP - NavCub",
               "Mt5CubAP - NavTal", #
               "Mt5CubAP - TalCal", #
               "NavCub - NavTal",
               "NavCub - TalCal", #
               "NavTal - TalCal") #

jointP = c("0.0664", "0.4577", "0.0358", "0.0000", "0.3474", "0.0008", "0.0000", "0.0287", "0.0010", "0.0010")

jointResult = c("CubCal = Mt5CubAP",
           "CubCal = NavCub",
           "CubCal = NavTal",
           "CubCal > TalCal", #
           "Mt5CubAP = NavCub",
           "Mt5CubAP > NavTal", #
           "Mt5CubAP > TalCal", #
           "NavCub = NavTal",
           "NavCub > TalCal", #
           "NavTal > TalCal") #


##### Species P = .0167 #####
specComp = c("Human - Chimp",
             "Human - Baboon",
             "Baboon - Chimp",
             "","","","","","","")

specP = c("0.3726  ", "0.7373  ", "0.7128  ",
             "","","","","","","")

specResult = c("Human = Chimp",
             "Human = Baboon",
             "Baboon = Chimp",
             "","","","","","","")


##### Species+Joint P = .0167 (.05 for m5) #####
ccResult = c("","","") ; m5Result = c("Human > Chimp","",""); ncResult = c("","",""); ntResult = c("Human > Chimp","Human > Baboon",""); tcResult = c("","Human > Baboon","")

res = c("Human - Chimp",
        "Human - Baboon",
        "Baboon - Chimp")#,
        #"Results", "", "")

ccP = c("0.0511", "0.1555 ", "0.5232") #, ccResult)

m5P = c("0.0441", "", "") #, m5Result)                 

ncP = c("0.8586", "0.0847", "0.2387 ") #, ncResult) 

ntP = c("0.0004", "0.0001", "0.0685") #, ntResult) 

tcP = c("0.0334", "0.0014", "0.2595") #, tcResult) 

tab1 = data.frame(jointComp, jointP, jointResult,
                  specComp, specP, specResult)

tab2 = data.frame(res,
                  m5P, ccP, ncP, ntP, tcP)
```

```{r}
tab1 %>%
  gt() %>%
  gt_theme_nytimes() %>%
  tab_header(title="Table 1") %>%
  tab_spanner(label="Joint Comparisons", columns = c(jointComp, jointP, jointResult)) %>%
  tab_spanner(label="Species Comparisons", columns = c(specComp, specP, specResult)) %>%
  cols_label( jointComp = "Comparison", specComp = "Comparison",
              jointP = "P Value", specP = "P Value",
              jointResult = "Result", specResult = "Result")
```

Next, I performed the permutation test separated by both joint *and* species. Once again, all but one of these tests used an $\alpha$ level of 0.0167, as there were 3 comparisons per joint. The Mt5CubAP joint was not measured in the baboon, leading to only 1 comparison; thus an $\alpha$ level of 0.05 could be used. These tests are shown below in *table 2*:

```{r}
tab2 %>%
  gt() %>%
  gt_theme_nytimes() %>%
  tab_header(title="Table 2", subtitle = "Species Comparisons by Joint") %>%
  cols_label( res           = "Comparison",
              ccP           = "CubCal",
              m5P           = "Mt5CubAP",
              ncP           = "NavCub",
              ntP           = "NavTal",
              tcP           = "TalCal")
```

**Table 2 Results**

* Mt5CubAP: Human > Chimp

* NavTal: Human > Chimp, Human > Baboon

* TalCal: Human > Baboon

In conclusion, there is no significant broad difference in AMA between humans, chimpanzees, and baboons. However, there is a significant evidence that humans differ from the other two species in various specefic joints. Humans were found to have higher a AMA than chimpanzees in the Mt5CubAP and NavTal joints as well as a higher AMA than baboons in TalCal and NavTal joints. Of these joints, Mt5CubAP was found to have a higher AMA than both the NavTal and TalCal, and NacTal higher than TalCal.

\newpage












Simulation Study: Discuss the simulation study done to explore power. What simulations were
run and what general trends are you seeing in the graphs you ended up with? Do these results
match what youâ€™d expect to happen regarding change in sample size and change in spread
(kappa)?



Application to joint data: Discuss the results of applying your permutation test to the joint data.
Which species were found to be significantly different for which joints?

