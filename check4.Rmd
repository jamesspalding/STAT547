---
title: "Untitled"
author: "James Spalding"
date: "2024-03-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source(paste0(getwd(),"/files/Power-graphs-mean.R")) #data
source("functions.R")
library(BSDA)
```

```{r}
pvalGraphs = function(n,k, ang){
  data = generateData(n,k, ANG = ang)
    A = data[[1]]
    B = data[[2]]
  
  result = arrayPerm(A,B,silent = T)
  angle = result[[1]]
  pval = result[[2]]
  
  return(pval)
}

pvalGraphs(10,5, .1)
```

```{r, eval=F}
ks = c(5, 20,50,100) #Takes ~2 hours to run
for(k in ks){

cat("\n########## k =", k, "##########\n")
  
samps = 100
power=power50=power100=rep(0,30)
mvals=seq(.02,.6,,30) #breaks at 0 about half the time.
starttime = Sys.time()

for(m in 1:30){
cat(round(100*m/30,0),"%\n")
  mval=mvals[m]
  count10=0 
  count50=0
  count100=0
  
  for(i in 1:samps){ 
    if(pvalGraphs(10,k,mval)<.05){
      count10=count10+1
    }
    if(pvalGraphs(50,k,mval)<.05){
      count50=count50+1
    }
    if(pvalGraphs(100,k,mval)<.05){
      count100=count100+1
    }
  }
  
  power[m]=count10/samps
  power50[m]=count50/samps
  power100[m]=count100/samps

}

#time
endtime = Sys.time()
print(endtime-starttime)

#output
out = cbind(power,power50) %>% cbind(power100)
write.csv(out, paste0("output",k,".csv"))
}
```

# Plots

```{r}
mvals=seq(.02,.6,,30)
k5 = read.csv("output5.csv")
k20 = read.csv("output20.csv")
k50 = read.csv("output50.csv")
k100 = read.csv("output100.csv")

ggplot(data = k5, aes(mvals, power)) +
  geom_line(aes(color = "Black")) + 
  geom_line(aes(mvals, power50, color = "Blue")) +
  geom_line(aes(mvals, power100, color = "Red")) +
  scale_color_manual(values = c("Black" = "black", "Blue" = "blue", "Red" = "red")) +
  labs(x = "Angle", y = "Power", title = "Power Graph k = 5")



```

